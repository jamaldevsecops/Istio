# Run Sample Applicaiton 
Ref: https://istio.io/latest/docs/setup/getting-started/  
Pre-requiste:  
## 1. Install the Kubernetes Gateway API CRDs 
The Kubernetes Gateway API CRDs do not come installed by default on most Kubernetes clusters, so make sure they are installed before using the Gateway API.  
1. Install the Gateway API CRDs, if they are not already present:  
```bash
kubectl get crd gateways.gateway.networking.k8s.io &> /dev/null || \
{ kubectl kustomize "github.com/kubernetes-sigs/gateway-api/config/crd?ref=v1.3.0-rc.1" | kubectl apply -f -; }
```
## 2. Deploy the Sample Application
You have configured Istio to inject sidecar containers into any application you deploy in your default namespace.  
1. Deploy the Bookinfo sample application:
```bash
kubectl apply -f ~/istio-1.26.1/samples/bookinfo/platform/kube/bookinfo.yaml
kubectl get services
kubectl get pod
```
## 3. Open the Application to Outside Traffic
The Bookinfo application is deployed, but not accessible from the outside. To make it accessible, you need to create an ingress gateway, which maps a path to a route at the edge of your mesh.  
1. **Create a Kubernetes Gateway for the Bookinfo application:**
```bash
kubectl apply -f ~/istio-1.26.1/samples/bookinfo/gateway-api/bookinfo-gateway.yaml
```
By default, Istio creates a LoadBalancer service for a gateway. As we will access this gateway by a tunnel, we donâ€™t need a load balancer. If you want to learn about how load balancers are configured for external IP addresses, read the ingress gateways documentation.  
2. **Change the service type to ```ClusterIP``` by annotating the gateway:**
```bash
kubectl get gateway
```
Sample Output: 
```plain
NAME               CLASS   ADDRESS          PROGRAMMED   AGE
bookinfo-gateway   istio   192.168.20.132   True         9m9s
```
```bash
kubectl annotate gateway bookinfo-gateway networking.istio.io/service-type=ClusterIP --namespace=default
```
3. **To check the status of the gateway, run:**
```bash
kubectl get gateway
```
Sample Output:  
```plain
NAME               CLASS   ADDRESS                                            PROGRAMMED   AGE
bookinfo-gateway   istio   bookinfo-gateway-istio.default.svc.cluster.local   True         9m22s
```
## 4. Access the Application 
You will connect to the Bookinfo productpage service through the gateway you just provisioned. To access the gateway, you need to create a ingress gateway:
1. Create an Ingress Resource: Create a file named ```bookinfo-ingress.yaml```:
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: bookinfo-ingress
  namespace: default
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - bookinfo.apsissolutions.com
    secretName: bookinfo-tls
  rules:
  - host: bookinfo.apsissolutions.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: bookinfo-gateway-istio
            port:
              number: 80
```
```bash
kubectl apply -f bookinfo-ingress.yaml
```
2. Configure TLS: If you have a certificate, create a Kubernetes secret:
```bash
kubectl create secret tls bookinfo-tls --cert=/home/ops/2025/CA_chain.crt --key=/home/ops/2025/apsissolutions.com.key -n default
```
3. Then access:
```plain
https://bookinfo.apsissolutions.com/productpage
```



