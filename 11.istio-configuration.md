## Istio Configuraiton 
![image](https://github.com/user-attachments/assets/faa2bc6f-493b-42f1-8b05-43d70389ea35)


To install Istio, Kiali, Grafana, and Jaeger on your Kubernetes cluster with an Nginx Ingress Gateway and access Kiali via https://kiali.apsissolutions.com, follow these steps. I’ll provide a concise guide, assuming you have a working Kubernetes cluster and kubectl configured.
Prerequisites
    - Kubernetes cluster: Ensure it’s running and accessible via kubectl.
    - Nginx Ingress Controller: Already installed and configured.
    - Domain: Ensure kiali.apsissolutions.com is pointed to your Nginx Ingress Controller’s external IP via DNS.
    - Tools: Install helm (v3.8+), istioctl (Istio CLI), and kubectl on your local machine.
    - TLS Certificate: A valid TLS certificate for kiali.apsissolutions.com (e.g., via Cert-Manager or manual setup).

Step 1: Install Istio
1. Download Istio: 
```bash
curl -L https://istio.io/downloadIstio | sh -
cd istio-<version>
export PATH=$PWD/bin:$PATH
```
2. Install Istio with Helm:
Create a namespace for Istio:
```bash
kubectl create namespace istio-system
```
Install Istio using the demo profile (suitable for testing with Kiali, Grafana, and Jaeger):
```bash
istioctl install --set profile=demo -y
```
Verify Istio is running:
```bash
kubectl get pods -n istio-system
```
3. Enable Istio Injection:
Enable automatic sidecar injection for the namespace where your apps will run (e.g., default):
```bash
kubectl label namespace default istio-injection=enabled
```
Step 2: Install Kiali, Grafana, and Jaeger
Istio’s demo profile includes Kiali, Grafana, and Jaeger. To enable and configure them:

1. Verify Add-ons Installation:
Check if the add-ons are running:
```bash
kubectl get pods -n istio-system | grep -E 'kiali|grafana|jaeger'
```
If not installed, you can install them via Helm:
```bash
ls samples/addons
kubectl apply -f samples/addons/kiali.yaml -n istio-system
kubectl apply -f samples/addons/grafana.yaml -n istio-system
kubectl apply -f samples/addons/jaeger.yaml -n istio-system
kubectl apply -f samples/addons/prometheus.yaml -n istio-system
kubectl get pods -n istio-system | grep -E 'kiali|grafana|jaeger'
```
or, 
```bash
kubectl apply -f ./samples/addons
kubectl get pods -n istio-system
kubectl get svc -n istio-system
```

Step 3: Configure Istio Ingress for Kiali
To expose Kiali via https://kiali.apsissolutions.com using Istio Gateway + VirtualService:

1. Create a Gateway Resource: Create a file named ```kiali-gateway.yaml```:
```yaml
# kiali-gateway.yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: kiali-gateway
  namespace: istio-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 443
      name: https-kiali
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: apsis-tls
    hosts:
    - "kiali.apsissolutions.com"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: kiali-vs
  namespace: istio-system
spec:
  hosts:
  - "kiali.apsissolutions.com"
  gateways:
  - kiali-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: kiali.istio-system.svc.cluster.local
        port:
          number: 20001
```
2. Configure TLS:
If you have a certificate, create a Kubernetes secret:
```bash
kubectl create secret tls apsis-tls --cert=/home/ops/2025/CA_chain.crt --key=/home/ops/2025/apsissolutions.com.key -n istio-system
```
3. Apply Ingress:
```bash
kubectl apply -f kiali-gateway.yaml
```
4. Verify DNS: Ensure kiali.apsissolutions.com resolves to your Nginx Ingress Controller’s external IP:
```bash
nslookup kiali.apsissolutions.com
```
Step 4: Access Kiali
- Open https://kiali.apsissolutions.com in your browser.
- Log in using Kiali credentials (default: admin/admin, or configured via Kiali’s ConfigMap).

Step 5: Access Grafana and Jaeger (Optional)
To access Grafana and Jaeger similarly, create Istio gateway resources for them in the istio-system namespace. Example for Grafana:
```yaml
# grafana-gateway.yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: grafana-gateway
  namespace: istio-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 443
      name: https-grafana
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: apsis-tls
    hosts:
    - "grafanax.apsissolutions.com"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: grafana-vs
  namespace: istio-system
spec:
  hosts:
  - "grafanax.apsissolutions.com"
  gateways:
  - grafana-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: grafana.istio-system.svc.cluster.local
        port:
          number: 3000
```
Repeat for Jaeger (port 16686, service name jaeger-query). Update DNS for grafana.apsissolutions.com and jaeger.apsissolutions.com.
```yaml
# jaeger-gateway.yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: jaeger-gateway
  namespace: istio-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 443
      name: https-jaeger
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: apsis-tls
    hosts:
    - "jaeger.apsissolutions.com"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: jaeger-vs
  namespace: istio-system
spec:
  hosts:
  - "jaeger.apsissolutions.com"
  gateways:
  - jaeger-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: tracing.istio-system.svc.cluster.local
        port:
          number: 80
```

Step 6: Verify Installation
- Check all components are running:
```bash
kubectl get pods -n istio-system
```
- Access Kiali at https://kiali.apsissolutions.com to visualize your service mesh.
- Optionally, access Grafana and Jaeger via their respective URLs if configured.

**Notes** 
- Security: Change default credentials for Kiali, Grafana, and Jaeger in production.
- Cert-Manager: Preferred for automatic TLS certificate management.
- Istio Profile: The demo profile is for testing; use default or minimal for production with only required components.
- DNS: Ensure your domain’s DNS records point to the Nginx Ingress Controller’s external IP.
Troubleshooting:
  - Check Ingress status: kubectl describe ingress kiali-ingress -n istio-system.
  - Verify certificate: kubectl describe secret kiali-tls -n istio-system.
  - Check Nginx logs: kubectl logs -n ingress-nginx <nginx-pod-name>.

If you encounter issues or need specific configurations (e.g., custom Istio settings, RBAC for Kiali), let me know!
